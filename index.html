<!DOCTYPE html> 
<html> 
<head> 
    <title>Home Questionnaire<span id="selection-marker-1" class="redactor-selection-marker"></span></title> 

    <!--Segment Snippet --> 
    <script>
        // global variable anonymousId, assigned on page call, accessible if sent serverside
        let serverAnonymousId
        let serverUserId = null
        let userId = null
        // function to be ran on load after .page() has completed and anonymousId is not null
        const callServer = () => {
            // assign variable value
            serverAnonymousId = analytics.user().anonymousId();
            // view variable value in console
            console.log('serverAnonymousId ',serverAnonymousId)

            const createUserId = () => {
                console.log("serverUserId : ",serverUserId)
                if(!serverUserId){
                    serverUserId = Math.floor((Math.random() * 100000) + 1);
                    console.log("NEW USER - serverUserId :" + serverUserId )
//                     return serverUserId
                }
                else{
                    console.log("serverUserId exists:" + serverUserId )
//                     return serverUserId
                }
            }
            console.log('serverUserId ',serverUserId)
            
            // return value to be used on backend
            return (serverAnonymousId,serverUserId)
        }  
      


        
      !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics._writeKey="GHWp3Jhvn2GBHxspEdZBRVhDmJKM4XC1";analytics.SNIPPET_VERSION="4.13.2";
      analytics.load("GHWp3Jhvn2GBHxspEdZBRVhDmJKM4XC1");
      analytics.page();
      analytics.ready(callServer);

      }}();
    </script> 

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poiret+One&display=swap" rel="stylesheet">

    <!-- Global site tag (gtag.js) - Google Analytics -->
<!--     <script async src="https://www.googletagmanager.com/gtag/js?id=UA-198119530-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-198119530-1');
    </script> -->

</head> 
    <style>
    body{
        /* padding-top: 50px; */
        font-family: 'Poiret One', cursive;
        background-color: rgba(20,20,20,1);
        color: rgba(220,220,220,8);
    }
    
    .navBar {
        width: 100%;
        /* height: 5vh; */
        background-color: aquamarine;
        display: flex;
        justify-content: space-between;
    }

    navBar-link, nav a {
        font-size: 1.5em;
        display: inline-block;
        text-align: left;
        margin: 0 10px;
    } 

    .resetUser {
        background-color: maroon;  
        color: gainsboro;
        padding: 2.5% .5%;
        border-radius: 50px;
        float: right;
        display: block;
        border: none;
        outline: none;
        
    }
    button:focus {
        border: none;
        outline: none;
    }

</style>

<body> 
    
<header id="navBar" class="clearfix">
    <nav class="navbar navbar-expand-lg ">
        <ul class="navbar-nav mr-auto">
            <a class="navbar-brand" onclick=trackNavRoute("logo","destinationForm") href="http://localhost:4000/"><h3>minifi</h3></a>
            <li class="nav-item">
                <a class="nav-link" onclick=trackNavRoute("home","destinationForm") href="http://localhost:4000/">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick=trackNavRoute("motivate","destinationForm") href="http://localhost:4000/motivate">Motivate</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick=trackNavRoute("mi chi","destinationForm") href="http://localhost:4000/chi">Mi Chi</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick=trackNavRoute("user","destinationForm") href="http://localhost:4000/user">User</a>
            </li>

            <li class="nav-item">
                <a class="nav-link" onclick=trackNavRoute("about","destinationForm") href="http://localhost:4000/about">About minifi</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" onclick=trackNavRoute("ghpages","destinationForm") href="https://lizkane222.github.io/Minifi.github.io/">GH PAGES</a>
            </li>

        </ul>
    </nav>
    <input type="button" onclick=runResetUser() class="resetUser" value="RESET USER"/>

</div>
    
    
<h1>What is your favorite place to travel?</h1> 
<p>I am building a directory of the sweetest travel destinations.</p>  
<form name="travel" onsubmit="identify(event)">
     What is your favorite travel destination?
    <input name="destination"  size="81" type="text"/> 
    <br><br><br> 
    Any recommendations (cool things to do, places to visit or restaurants to eat)? 
    <br><br> 
    <textarea cols="81" name="details"  rows="10">
    </textarea> 
    <br><br> 
    Name: <input name="fullname"  size="75" type="text"/> 
    <br><br> 
    Email: <input name="email" required="" size="75" type="email"/> 
    <br><br>
    <input name="submit" type="submit" value="submit"/>
</form> 

    <!--Segment identify and track script -->
    <script type="text/javascript">
//         let userId 
//         const createUserId = () => {
//             return userId = Math.floor((Math.random() * 100000) + 1);
//         }

// USER ID DOES NOT NEED TO BE PASSED
//         const createUserId = () => {
//             if(!userId){
//                 return userId = Math.floor((Math.random() * 100000) + 1);
//             }
//             else{
//                 console.log("userId exists:" + userId )
//                 return userId
//             }
//         }
        
        console.log(`Date.now() = `+ Date.now());
        let currentSessionId
        console.log(`currentSessionId should be blank : `+currentSessionId)
        
        let newSession = true
        const uTC = () => {
            if (!newSession){
                return currentSessionId
                console.log(`currentSessionId should be same : `+currentSessionId)
            }
            else {
                return currentSessionId = Date.now()    
                console.log(`currentSessionId should change : `+currentSessionId)
                newSession = false
            }
        }
        
      function identify(e){
        e.preventDefault();
        var form = e.target;
        var email = form["email"].value;
        var fullname = form["fullname"].value;
        var destination = form["destination"].value;
        var details = form["details"].value;
//         let session_id = Date.now()
        let session_id = uTC()
        var properties = {
            email: email, 
            name: fullname, 
            destination: destination, 
            details: details,
        };
        console.log(properties);
        analytics.identify({
          email: email, 
          name: fullname
        });
//         analytics.track('destination submitted',{},{integrations: {

        analytics.track('destination submitted',properties,{integrations: {
            "All": true,
            "Amplitude": {
                session_id: currentSessionId
            }
        }}, function() {
            window.location.href = "";
        });
      }
        
      const trackNavRoute = (navLinkName, currentPage) => {
            let properties = {
                navLinkName : navLinkName,
                currentPage : currentPage
            }

             analytics.track('navlink clicked',properties,{integrations: {
                "All": true,
                "Amplitude": {
                    session_id: currentSessionId
                }
            }}, function() {
                window.location.href = "";
            });
       }
        
        
    const runResetUser = () => {
        analytics.reset()
        console.log("reset has occured");
        console.log(Headers)
    }
    
    </script>  

    
<div class="main-index-container">
    <input type="text" name="firstName" id="firstName-main-index" placeholder="First Name"/>
    <input type="text" name="lastName" id="lastName-main-index" placeholder="Last Name"/>
    <input type="text" name="organization" id="organization-main-index" placeholder="Organization"/>
    <input type="email" name="email" id="email-main-index" required="" placeholder="Email"/>
    <input type="text" name="favoriteSocialMedia" id="fav-soc-media-main-index" required="" placeholder="Favorite Social Media To Use"/>
    <button id="submitNewAccountInputs" onclick="createNewAccount()">SAVE</button>
</div>

<script>
    

    
    
    let createNewAccount = () => {

        let firstName = document.getElementById("firstName-main-index").value || "test firstName";
        let lastName = document.getElementById("lastName-main-index").value || "test lastName";
        let organization = document.getElementById("organization-main-index").value || "test organization";
        let email = document.getElementById("email-main-index").value || "test email";
        let favSocMedia = document.getElementById("fav-soc-media-main-index").value || "test fav-soc-media";
        
        console.log("- firstName : ",firstName,"- lastName : ",lastName,"- organization : ",organization,"- email : ",email,)

        let traits = {
            firstName : firstName,
            lastName : lastName,
            organization : organization,
            email : email,
            userId : serverUserId,
            anonymousId : serverAnonymousId
        }

        let properties = {
            favSocMedia : favSocMedia
        }

        analytics.identify((userId || anonymousId),{traits})

        analytics.track(
            "New Account Created",
            {traits},
            {properties},
           function() {
                window.location.href = "";
            }
       )

        document.getElementById("submitNewAccountInputs").addEventListener("click",createNewAccount,true)

} //createNewAccount function end
</script>
    
    
    
    
</body> 


</html>

